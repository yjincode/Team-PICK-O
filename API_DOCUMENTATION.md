# Team-PICK-O API 문서

## 개요
Team-PICK-O 프로젝트의 백엔드 API 엔드포인트들을 정리한 문서입니다.

**Base URL**: `http://localhost:8000/api/v1`

## 인증 (Authentication)

### JWT 토큰 기반 인증
모든 API는 JWT 액세스 토큰이 필요합니다. (공개 엔드포인트 제외)

**토큰 갱신 자동 처리**
- 액세스 토큰 만료 시 자동으로 리프레시 토큰을 사용하여 갱신
- 갱신 실패 시 로그인 페이지로 자동 리다이렉트

### 공개 엔드포인트 (토큰 불필요)
- `/business/auth/firebase-to-jwt/`
- `/business/auth/register/`
- `/business/auth/refresh/`

## API 엔드포인트

### 1. 인증 API (authApi)

#### 회원가입
- **POST** `/business/auth/register/`
- **설명**: 새로운 사용자를 등록합니다
- **요청 본문**: 사용자 정보 객체

#### 사용자 상태 확인
- **GET** `/business/auth/status/`
- **파라미터**: `firebase_uid` (쿼리 파라미터)
- **설명**: Firebase UID로 사용자 상태를 확인합니다

#### 로그아웃
- **POST** `/auth/logout`
- **설명**: 사용자 로그아웃을 처리합니다

#### 현재 사용자 정보 조회
- **GET** `/auth/me`
- **설명**: 현재 로그인한 사용자의 정보를 조회합니다

### 2. 거래처 관리 API (businessApi)

#### 모든 거래처 조회
- **GET** `/business/customers/`
- **파라미터**: 
  - `page` (옵션): 페이지 번호
  - `page_size` (옵션): 페이지당 항목 수
- **설명**: 페이지네이션을 지원하는 거래처 목록 조회

#### 거래처 상세 조회
- **GET** `/business/customers/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 특정 ID의 거래처 정보 조회

#### 거래처 생성
- **POST** `/business/customers/create/`
- **요청 본문**: 거래처 정보 객체 (id 제외)
- **설명**: 새로운 거래처를 생성합니다

#### 거래처 수정
- **PUT** `/business/customers/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: 수정할 거래처 정보 (부분 업데이트 지원)
- **설명**: 기존 거래처 정보를 수정합니다

#### 거래처 삭제
- **DELETE** `/business/customers/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 거래처를 삭제합니다

### 3. 어종 관리 API (fishTypeApi)

#### 모든 어종 조회
- **GET** `/fish-registry/fish-types/`
- **설명**: 등록된 모든 어종 목록을 조회합니다

#### 어종 상세 조회
- **GET** `/fish-registry/fish-types/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 특정 ID의 어종 정보 조회

#### 어종 생성
- **POST** `/fish-registry/fish-types/`
- **요청 본문**: 어종 정보 객체 (id, created_at 제외)
- **설명**: 새로운 어종을 등록합니다

#### 어종 수정
- **PUT** `/fish-registry/fish-types/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: 수정할 어종 정보
- **설명**: 기존 어종 정보를 수정합니다

#### 어종 삭제
- **DELETE** `/fish-registry/fish-types/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 어종을 삭제합니다

#### 어종 검색
- **GET** `/fish-registry/fish-types/`
- **파라미터**: `search` (쿼리 파라미터)
- **설명**: 검색어로 어종을 검색합니다

### 4. 재고 관리 API (inventoryApi)

#### 모든 재고 조회
- **GET** `/inventory/`
- **파라미터**:
  - `search` (옵션): 검색어
  - `status` (옵션): 상태 필터
- **설명**: 재고 목록을 조회합니다

#### 재고용 어종 목록 조회
- **GET** `/fish-registry/fish-types/`
- **설명**: 재고 추가 시 선택할 수 있는 어종 목록

#### 재고 상세 조회
- **GET** `/inventory/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 특정 재고 항목의 상세 정보

#### 재고 생성
- **POST** `/inventory/`
- **요청 본문**:
  - `fish_type_id`: 어종 ID
  - `stock_quantity`: 재고 수량
  - `unit`: 단위
  - `status`: 상태
  - `aquarium_photo_path` (옵션): 수조 사진 경로
- **설명**: 새로운 재고 항목을 생성합니다

#### 재고 수정
- **PUT** `/inventory/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: 수정할 재고 정보
- **설명**: 기존 재고 정보를 수정합니다

#### 재고 삭제
- **DELETE** `/inventory/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 재고 항목을 삭제합니다

#### 재고 로그 조회
- **GET** `/inventory/logs/` 또는 `/inventory/{id}/logs/`
- **파라미터**: `id` (옵션, 특정 재고의 로그만 조회)
- **설명**: 재고 변동 로그를 조회합니다

### 5. 주문 관리 API (orderApi)

#### 모든 주문 조회
- **GET** `/order/`
- **파라미터**:
  - `page` (옵션): 페이지 번호
  - `page_size` (옵션): 페이지당 항목 수
- **설명**: 주문 목록을 조회합니다

#### 주문 상세 조회
- **GET** `/order/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 특정 주문의 상세 정보

#### 주문 생성
- **POST** `/order/upload/`
- **요청 본문**: 주문 정보 객체 (id 제외)
- **설명**: 새로운 주문을 생성합니다
- **특별 기능**: 음성 파일과 함께 전송 시 FormData 형식 지원

#### 주문 수정
- **PUT** `/order/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: 수정할 주문 정보
- **설명**: 기존 주문 정보를 수정합니다

#### 주문 삭제
- **DELETE** `/order/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 주문을 삭제합니다

#### 주문 상태 업데이트
- **PATCH** `/order/{id}/status/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: `{ "order_status": "상태값" }`
- **설명**: 주문 상태만 업데이트합니다

### 6. 결제 관리 API (paymentApi, paymentsApi)

#### 모든 결제 조회
- **GET** `/payments/`
- **파라미터**:
  - `page` (옵션): 페이지 번호
  - `page_size` (옵션): 페이지당 항목 수
- **설명**: 결제 내역을 조회합니다

#### 결제 상세 조회
- **GET** `/payments/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 특정 결제의 상세 정보

#### 결제 생성
- **POST** `/payments/`
- **요청 본문**: 결제 정보 객체 (id, created_at 제외)
- **설명**: 새로운 결제를 생성합니다

#### 결제 수정
- **PUT** `/payments/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **요청 본문**: 수정할 결제 정보
- **설명**: 기존 결제 정보를 수정합니다

#### 결제 삭제
- **DELETE** `/payments/{id}/`
- **파라미터**: `id` (경로 파라미터)
- **설명**: 결제를 삭제합니다

#### 토스 페이먼츠 결제 승인
- **POST** `/payment/toss/confirm/`
- **요청 본문**:
  - `paymentKey`: 결제 키
  - `orderId`: 주문 ID
  - `amount`: 결제 금액
- **설명**: 토스 페이먼츠 결제를 승인합니다

### 7. 매출 분석 API (salesApi)

#### 매출 데이터 조회
- **GET** `/order/`
- **파라미터**:
  - `page` (옵션): 페이지 번호
  - `page_size` (옵션): 페이지당 항목 수
- **설명**: 매출 분석용 주문 데이터 조회

#### 매출 차트 데이터
- **GET** `/sales/chart/`
- **설명**: 매출 차트 표시용 데이터를 조회합니다

#### 경매 예측 데이터
- **GET** `/sales/auction-prediction/`
- **설명**: AI 기반 경매 가격 예측 데이터를 조회합니다

### 8. AI 분석 API (aiApi)

#### AI 로그 조회
- **GET** `/ai/logs/`
- **설명**: AI 분석 로그를 조회합니다

#### AI 분석 실행
- **POST** `/ai/analysis/`
- **요청 본문**: 분석할 데이터
- **설명**: AI 분석을 실행합니다

### 9. 음성 인식 API (sttApi)

#### 음성을 텍스트로 변환
- **POST** `/transcription/transcribe/`
- **요청 형식**: `multipart/form-data`
- **요청 본문**:
  - `audio`: 음성 파일 (File)
  - `language`: 언어 코드 (기본값: 'ko')
- **응답**:
  ```json
  {
    "message": "변환 완료 메시지",
    "transcription": "변환된 텍스트",
    "language": "언어 코드"
  }
  ```
- **설명**: 음성 파일을 텍스트로 변환합니다 (인증 불필요)

## 응답 형식

### 성공 응답
```json
{
  "data": { ... },
  "message": "성공 메시지"
}
```

### 페이지네이션 응답
```json
{
  "data": {
    "results": [ ... ],
    "count": 총_개수,
    "next": "다음_페이지_URL",
    "previous": "이전_페이지_URL"
  }
}
```

### 오류 응답
```json
{
  "error": "오류 메시지",
  "details": { ... }
}
```

## 에러 코드

- **400**: 잘못된 요청 (유효성 검사 실패)
- **401**: 인증 실패 (토큰 없음 또는 만료)
- **403**: 권한 없음
- **404**: 리소스를 찾을 수 없음
- **500**: 서버 내부 오류

## 특별 기능

### 음성 주문 처리 플로우
1. 음성 파일 업로드 (`/transcription/transcribe/`)
2. STT 변환 완료 후 자동 주문 파싱
3. 파싱된 데이터를 주문 API로 전송 (`/order/upload/`)

### 자동 토큰 갱신
- 모든 API 요청에서 액세스 토큰 만료를 자동 감지
- 만료된 경우 리프레시 토큰으로 자동 갱신
- 갱신 실패 시 로그인 페이지로 리다이렉트

### 자연어 처리
- 음성/텍스트에서 어종, 수량, 단위, 배송일, 거래처명 자동 추출
- 기존 어종/거래처 데이터베이스와 자동 매칭
- 매칭 실패 시 신규 등록 제안

## 개발 환경
- **백엔드**: Django REST Framework
- **인증**: JWT (JSON Web Token)
- **데이터베이스**: PostgreSQL (추정)
- **음성 처리**: OpenAI Whisper API
- **결제**: 토스 페이먼츠 연동