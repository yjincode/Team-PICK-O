name: Dev Branch CI (ë‹¨ìˆœí™”)

on:
  pull_request:
    branches:
      - dev
  # dev ë¸Œëœì¹˜ ì§ì ‘ í‘¸ì‹œëŠ” ì œì™¸ (PR í†µí•´ì„œë§Œ ì§„í–‰)

jobs:
  build-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ê¸°ë³¸ ì •ë³´
      run: |
        echo "ğŸ” Dev ë¸Œëœì¹˜ ë¹Œë“œ ì²´í¬ ì¤‘..."
        echo "ì´ë²¤íŠ¸: ${{ github.event_name }}"
        echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
        echo "ì»¤ë°‹: ${{ github.sha }}"
    
    - name: Docker ì»´í¬ì¦ˆ ë¹Œë“œ í…ŒìŠ¤íŠ¸
      run: |
        echo "ğŸ”¨ Docker Compose ë¹Œë“œ í…ŒìŠ¤íŠ¸..."
        cd deployment
        
        # ì„¤ì • íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
        docker compose config
        echo "âœ… Docker Compose ì„¤ì • ìœ íš¨"
        
        # ê°œë°œìš© ë¹Œë“œ í…ŒìŠ¤íŠ¸
        if [ -f "docker-compose.dev.yml" ]; then
          docker compose -f docker-compose.dev.yml build
          echo "âœ… ê°œë°œìš© ì´ë¯¸ì§€ ë¹Œë“œ ì„±ê³µ"
        fi
    
    - name: í”„ë¡œë•ì…˜ ì¤€ë¹„ í™•ì¸
      run: |
        echo "ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ìƒíƒœ í™•ì¸..."
        
        # í•„ìˆ˜ íŒŒì¼ ì²´í¬
        files_to_check=(
          "backend/Dockerfile"
          "frontend/Dockerfile" 
          "deployment/docker-compose.yml"
          "deployment/nginx.conf"
        )
        
        for file in "${files_to_check[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file ì¡´ì¬"
          else
            echo "âŒ $file ëˆ„ë½"
            exit 1
          fi
        done
        
        echo "âœ… ëª¨ë“  í•„ìˆ˜ íŒŒì¼ ì¡´ì¬ í™•ì¸"
    
    - name: ë¹Œë“œ ì™„ë£Œ
      run: |
        echo "âœ… Dev ë¸Œëœì¹˜ CI ì™„ë£Œ"
        echo "ğŸš€ main ë¸Œëœì¹˜ë¡œ ë³‘í•© ì‹œ ìë™ ë°°í¬ë©ë‹ˆë‹¤"