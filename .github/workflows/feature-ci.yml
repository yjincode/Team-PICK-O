name: Feature Branch CI (ë‹¨ìˆœí™”)

on:
  push:
    branches:
      - 'feature/**'

jobs:
  ci-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ê¸°ë³¸ ì²´í¬
      run: |
        echo "ğŸ” Feature ë¸Œëœì¹˜ ê¸°ë³¸ ì²´í¬ ì¤‘..."
        echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
        echo "ì»¤ë°‹: ${{ github.sha }}"
        ls -la
    
    - name: Docker ë¹Œë“œ í…ŒìŠ¤íŠ¸
      run: |
        echo "ğŸ”¨ Docker ë¹Œë“œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸..."
        
        # Backend ë¹Œë“œ ì²´í¬
        if [ -f "backend/Dockerfile" ]; then
          echo "âœ… Backend Dockerfile ì¡´ì¬"
          cd backend && docker build --dry-run . && cd ..
        fi
        
        # Frontend ë¹Œë“œ ì²´í¬  
        if [ -f "frontend/Dockerfile" ]; then
          echo "âœ… Frontend Dockerfile ì¡´ì¬"
          cd frontend && docker build --dry-run . && cd ..
        fi
    
    - name: ìë™ PR ìƒì„± (feature â†’ dev)
      uses: repo-sync/pull-request@v2
      with:
        source_branch: ${{ github.ref_name }}
        destination_branch: "dev"
        github_token: ${{ secrets.GITHUB_TOKEN }}
        pr_title: "ğŸš€ [ìë™ìƒì„±] ${{ github.ref_name }} â†’ dev"
        pr_body: |
          ## ğŸ“‹ ë³€ê²½ì‚¬í•­
          - Feature ë¸Œëœì¹˜: `${{ github.ref_name }}`
          - ì»¤ë°‹ í•´ì‹œ: `${{ github.sha }}`
          - ì‘ì„±ì: ${{ github.actor }}
          - í‘¸ì‹œ ì‹œê°„: ${{ github.event.head_commit.timestamp }}
          
          ## ğŸ” ì²´í¬ë¦¬ìŠ¤íŠ¸
          - [x] Docker ë¹Œë“œ ê°€ëŠ¥ í™•ì¸
          - [ ] ì½”ë“œ ë¦¬ë·° í•„ìš”
          - [ ] ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í•„ìš”
          - [ ] ì¶©ëŒ í•´ê²° í™•ì¸
          
          ## ğŸ¤– ìë™ ìƒì„±ëœ PR
          ì´ PRì€ `${{ github.ref_name }}` ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
          
          **âš ï¸ ë³‘í•© ì „ í™•ì¸ì‚¬í•­:**
          1. âœ… ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
          2. âœ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ  
          3. âœ… ì¶©ëŒ í•´ê²° ì™„ë£Œ
          4. âœ… CI ì²´í¬ í†µê³¼
          
          **ğŸ“ ë³€ê²½ëœ íŒŒì¼ë“¤:**
          - ìë™ìœ¼ë¡œ ê°ì§€ëœ ë³€ê²½ì‚¬í•­ë“¤ì´ í¬í•¨ë©ë‹ˆë‹¤
        pr_draft: false
        
    - name: PR ìƒì„± ê²°ê³¼
      run: |
        echo "âœ… Feature ë¸Œëœì¹˜ CI ì™„ë£Œ"
        echo "ğŸ“ ìë™ PRì´ dev ë¸Œëœì¹˜ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
        echo "ğŸ”— GitHubì—ì„œ PRì„ í™•ì¸í•˜ì„¸ìš”"