name: Feature Branch CI (ë‹¨ìˆœí™”)

on:
  push:
    branches:
      - 'feature/**'

jobs:
  ci-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ê¸°ë³¸ ì²´í¬
      run: |
        echo "ğŸ” Feature ë¸Œëœì¹˜ ê¸°ë³¸ ì²´í¬ ì¤‘..."
        echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
        echo "ì»¤ë°‹: ${{ github.sha }}"
        ls -la
    
    - name: Docker ë¹Œë“œ í…ŒìŠ¤íŠ¸
      run: |
        echo "ğŸ”¨ Docker ë¹Œë“œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸..."
        
        # Backend ë¹Œë“œ ì²´í¬
        if [ -f "backend/Dockerfile" ]; then
          echo "âœ… Backend Dockerfile ì¡´ì¬"
          cd backend && docker build --dry-run . && cd ..
        fi
        
        # Frontend ë¹Œë“œ ì²´í¬  
        if [ -f "frontend/Dockerfile" ]; then
          echo "âœ… Frontend Dockerfile ì¡´ì¬"
          cd frontend && docker build --dry-run . && cd ..
        fi
    
    - name: ìë™ PR ìƒì„±
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: "feat: ${{ github.ref_name }} ì‘ì—… ì™„ë£Œ"
        title: "ğŸš€ [ìë™ìƒì„±] ${{ github.ref_name }} â†’ dev"
        body: |
          ## ğŸ“‹ ë³€ê²½ì‚¬í•­
          - Feature ë¸Œëœì¹˜: `${{ github.ref_name }}`
          - ì»¤ë°‹ í•´ì‹œ: `${{ github.sha }}`
          - ì‘ì„±ì: ${{ github.actor }}
          
          ## ğŸ” ì²´í¬ë¦¬ìŠ¤íŠ¸
          - [x] Docker ë¹Œë“œ ê°€ëŠ¥
          - [ ] ì½”ë“œ ë¦¬ë·° í•„ìš”
          - [ ] í…ŒìŠ¤íŠ¸ í™•ì¸ í•„ìš”
          
          ## ğŸ¤– ìë™ ìƒì„±ëœ PR
          ì´ PRì€ feature ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
          
          **ë³‘í•© ì „ í™•ì¸ì‚¬í•­:**
          1. ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
          2. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
          3. ì¶©ëŒ í•´ê²° ì™„ë£Œ
        base: dev
        branch: auto-pr/${{ github.ref_name }}
        delete-branch: true
        draft: false
        
    - name: PR ìƒì„± ê²°ê³¼
      run: |
        echo "âœ… Feature ë¸Œëœì¹˜ CI ì™„ë£Œ"
        echo "ğŸ“ ìë™ PRì´ dev ë¸Œëœì¹˜ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
        echo "ğŸ”— GitHubì—ì„œ PRì„ í™•ì¸í•˜ì„¸ìš”"